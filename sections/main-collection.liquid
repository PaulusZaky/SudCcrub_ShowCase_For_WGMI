{%- render 'section-spacing-collapsing' -%}

{%- if section.settings.show_filters and collection.filters.size > 0 -%}
  {%- assign show_filters = true -%}
{%- else -%}
  {%- assign show_filters = false -%}
{%- endif -%}

<style>
    {%- assign card_blends = false -%}

    {%- unless settings.background != 'rgba(0,0,0,0)' and settings.product_card_background != 'rgba(0,0,0,0)' and settings.background != settings.product_card_background -%}
      {%- assign card_blends = true -%}
    {%- endunless -%}

    #shopify-section-{{ section.id }} {
      --product-list-gap: {% if section.settings.products_per_row_mobile == '2' %}{% if card_blends %}var(--product-list-row-gap){% endif %} var(--spacing-2){% else %}var(--product-list-row-gap) var(--product-list-column-gap){% endif %};
      --product-list-items-per-row: {{ section.settings.products_per_row_mobile | times: 1 }};
      --product-list-grid: auto-flow dense / repeat(var(--product-list-items-per-row), minmax(0, 1fr));
      --product-list-promo-grid-column: span {{ section.settings.products_per_row_mobile }};

      --content-over-media-gap: var(--spacing-8);
      background: #FFFFFF;
    }

    #shopify-section-{{ section.id }} .container {
      margin: 0 18px;
    }
    #shopify-section-{{ section.id }} .mobile-collection.collection {
      gap: 0;
      display: grid;
    }
    #shopify-section-{{ section.id }} .desktop-collection  {
      display: none;
    }
    #shopify-section-{{ section.id }} .container .product-list {
      row-gap: 18px;
      column-gap: 20px;
    }
    #shopify-section-{{ section.id }} .sort-by-facet {
      align-items: center;
      justify-content: space-between;
    }
    #shopify-section-{{ section.id }} .collection>.text-with-icon,
    #shopify-section-{{ section.id }} .collection__facets,
    #shopify-section-{{ section.id }} .collection__top-bar {
      margin: 0 10px;
    }
    #shopify-section-{{ section.id }} .collection .text-with-icon button svg {
      width: 18px;
      height: 18px;
    }
    #shopify-section-{{ section.id }} .collection>.text-with-icon,
    #shopify-section-{{ section.id }} .collection .collection__facets .text-with-icon {
      padding-bottom: 20px;
      justify-content: space-between;
      align-items: center;
      font-family: var(--btn-font-family);
      font-size: 18px;
      font-weight: 700;
      line-height: 25.2px;
      text-align: left;
    }
    #shopify-section-{{ section.id }} .mobile-collection .collection__facets {
      padding: 0px 24px 26px 24px;
      border-radius: 0px 0px 22px 22px;
      box-shadow: 0px 25px 14px 0px #0000001F;
      display: none;
    }
    #shopify-section-{{ section.id }} .collection .collection__facets .accordion {
      padding:24px 20px;
    }
    #shopify-section-{{ section.id }} .collection.mobile-collection .collection__facets .accordion {
      border: none;
    }

    #shopify-section-{{ section.id }} #accordion-filter-p-product_type,
    #shopify-section-{{ section.id }} #accordion-filter-v-option-color {
      border-bottom: 1px solid #0000001A;
    }
    #shopify-section-{{ section.id }} .collection .collection__facets .accordion__toggle {
      padding: 0;
    }
    #shopify-section-{{ section.id }} .collection .collection__facets .accordion__toggle span {
      font-family: var(--btn-font-family);
      font-size: 16px;
      font-weight: 700;
      line-height: 25.2px;
      text-align: left;
    }
    #shopify-section-{{ section.id }} .collection .collection__facets .accordion__content {
      font-size: 16px;
      font-weight: 450;
      line-height: 24px;
      text-align: left;
      padding-top: 20px;
      color: #000;
      margin: 0;
    }
    #shopify-section-{{ section.id }} .popover-listbox__option {
      justify-content: left;
    }
    #shopify-section-{{ section.id }} .collection .sort-by-facet .popover::part(content) {
      border-radius: 0 0 22px 22px !important;
      box-shadow: 0px 25px 14px 0px #0000001F !important;
      border: none !important;
    }
    #shopify-section-{{ section.id }} .collection .sort-by-facet .popover::part(body) {
      padding: 7px 40px 17px 20px;
      min-width: 180px;
      border-radius: 0 0 22px 22px !important;
    }
    #shopify-section-{{ section.id }} .collection .popover-listbox .popover-listbox__option {
      padding: 7px 0;
    }

    #shopify-section-{{ section.id }} .collection .collection__facets .accordion__content .h-stack {
      gap: 10px;
    }
    #shopify-section-{{ section.id }} .color-swatch {
      width: 28px;
      height: 28px;
      margin: 0;
    }
    #shopify-section-{{ section.id }} .collection.mobile-collection .accordion {
      border-bottom: 1px solid #0000001A;
    }
    #shopify-section-{{ section.id }} .collection.mobile-collection .collection__top-bar {
      padding-top: 24px;
    }
    #shopify-section-{{ section.id }} .collection.desktop-collection .collection__top-bar {
      display: grid;
    }
    #shopify-section-{{ section.id }} .collection.mobile-collection>.text-with-icon {
      border-bottom: 1px solid #0000001A;
    }

    #shopify-section-{{ section.id }} .collection {
      margin-top: 35px !important;
    }

    #shopify-section-{{ section.id }} .sort-by-facet span.bold {
      font-family: var(--btn-font-family);
      font-size: 18px;
      font-weight: 700;
      line-height: 25.2px;
      text-align: left;
    }
    #shopify-section-{{ section.id }} .sort-by-facet .text-with-icon .reversed-link{
      font-family: var(--btn-font-family);
      font-size: 14px;
      font-weight: 700;
      text-align: center;
    }
    {% comment %} #shopify-section-{{ section.id }} .collection__top-bar .text-with-icon .circle-chevron {
      width: 24px;
      height: 24px;
    } {% endcomment %}
    #shopify-section-{{ section.id }} .collection__top-bar .circle-chevron svg {
      width: 12px;
      height: 8px;
    }
    #shopify-section-{{ section.id }} .collection__top-bar .reversed-link {
      background: unset !important;
    }
    .collection__top-bar, .collection__facets {
      {% comment %} display: block; {% endcomment %}
    }
    .facet-clear-all {
      display: block;
      width: 100%;
      padding: 12px 0px;
      gap: 10px;
      border-radius: 8px;
      border: 2px;
      font-family: var(--btn-font-family);
      font-size: 18px;
      font-weight: 700;
      line-height: 27px;
      text-align: center;
      border: 2px solid #000000;
      margin-top: 24px;
      height: 57px;
    }
    .collection__top-bar .active-facets .facet-clear-all{
      display: none;
    }
    {% comment %} product-card {% endcomment %}
    #shopify-section-{{ section.id }} .product-card {
      border-radius: 0;
      transition: display 3s;
      display: flex;
      flex-direction: column;
      transition: 0.3s;
      background-image: unset;
      background-color: #FFF;
      border-radius: 20px;
      {% comment %} background-image: url('https://cdn.shopify.com/s/files/1/0496/2936/4391/files/gradient-bkgd-hover.png?v=1725035039'); {% endcomment %}
      background-size: cover;
      gap: 0;
    }
    #shopify-section-{{ section.id }} .product-card .product-card__figure {
      width: 82%;
      margin: 9% auto 0 auto;
    }
    #shopify-section-{{ section.id }} .product-card__info {
      padding: 0px;
      width: 100%;
    }
    #shopify-section-{{ section.id }} .product-comment {
      display: none;
    }

    #shopify-section-{{ section.id }} .product-card__info .v-stack{
      display: block
    }
    #shopify-section-{{ section.id }} .rating-with-text .jdgm-preview-badge {
      margin: auto;
    }

    #shopify-section-{{ section.id }} .rating-with-text .product-card__title{
      display: block;
      font-family: var(--heading-font-family);
      font-size: 14.24px;
      font-weight: 400;
      line-height: 16.63px;
      text-align: center;
      text-transform: uppercase;
    }
    #shopify-section-{{ section.id }} .rating-with-text {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      margin-top: 13.5px;
      gap: 4px;
    }
    #shopify-section-{{ section.id }} .price-list {
      margin: 9px 0;
      font-family: var(--btn-font-family);
      font-size: 10.52px;
      font-weight: 700;
      line-height: 10.31px;
      text-align: center;
    }
    #shopify-section-{{ section.id }} .product-card .product-card__swatch-list {
      gap: 5px;
      justify-content: center;
    }
    #shopify-section-{{ section.id }} .product-card .product-card__swatch-list .color-swatch {
      width: 12.43px;
      height: 12.43px;
    }
    #shopify-section-{{ section.id }} .product-card .product-card__swatch-list .color-swatch:before {
      content: url(/cdn/shop/files/check-mark-min.svg?v=1724226774);
      inset: unset
    }
    #shopify-section-{{ section.id }} .product-card .product-card__swatch-list .speckled.color-swatch:before {
      content: url(/cdn/shop/files/check-mark-black-min.svg?v=1724226774);
      inset: unset
    }
    #shopify-section-{{ section.id }} .product-card .product-card__aside {
      margin-bottom: 13.5px
    }

    #shopify-section-{{ section.id }} .price-list {
      justify-content: center;
    }
    #shopify-section-{{ section.id }} .rating-with-text .jdgm-preview-badge .jdgm-prev-badge__text {
      font-weight: 500;
      font-size: 14px;
      line-height: 21px;
      text-align: center;
    }
    #shopify-section-{{ section.id }} .rating-with-text .jdgm-prev-badge__stars .jdgm-star {
      color: #FF6A00;
      width: 7.65px;
      height: 7.17px;
    }
    #shopify-section-{{ section.id }} .goshop {
      width:142px;
      height: 26.21px;
      padding: 8.61px 0px;
      gap: 3.82px;
      border-radius: 23.91px;
      font-size: 9.56px;
      font-weight: 700;
      line-height: 9.37px;
      text-align: center;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 80%;
      margin: auto auto 9% auto;
      margin-top: 13.5px
    }
    #shopify-section-{{ section.id }} .goshop svg{
      width: 7.65px;
      height: 7.65px;
    }
    #shopify-section-{{ section.id }} .product-card .rating {
      display: none;
    }
    #shopify-section-{{ section.id }} .color-swatch__view-more {
      margin: 0;
      padding: 0;
      line-height: 0;
    }
    #shopify-section-{{ section.id }} .color-swatch__view-more:after {
      content: url('https://cdn.shopify.com/s/files/1/0496/2936/4391/files/plus-sign-mobile.svg?v=1725035038');
    }

    #accordion-sort-by span {
      text-transform: uppercase;
    }

    #shopify-section-{{ section.id }} .product-card__quick-buy button {
      font-size: 8px;
      padding: 5px 10px;
    }
    @media screen and (max-width: 300px) {
      #shopify-section-{{ section.id }} .product-card__quick-buy button {
        font-size: 6px;
        padding: 3px 6px;
      }
    }
    @media screen and (max-width: 390px) {
      #shopify-section-{{ section.id }} .rating-with-text .jdgm-prev-badge__text {
        display: block;
        text-align: center;
        font-size: 8.76px !important;
        line-height: 11.23px !important;
      }
    }
    @media screen and (min-width: 700px) {
      #shopify-section-{{ section.id }} {
        --product-list-gap: var(--product-list-row-gap) var(--product-list-column-gap);
        --product-list-items-per-row: 2;
        --product-list-promo-grid-column: span 1;
      }
      #shopify-section-{{ section.id }} .container {
        margin: 0 50px;
      }
      #shopify-section-{{ section.id }} .product-card {
        background-image: unset;
      }
      #shopify-section-{{ section.id }} .product-card .product-card__figure {
        margin: 30px auto 0 auto;
      }
      #shopify-section-{{ section.id }} .product-card:hover,
      #shopify-section-{{ section.id }} .product-card:focus{
        background-image: url('https://cdn.shopify.com/s/files/1/0496/2936/4391/files/gradient-bkgd-hover.png?v=1725035039');
        background-size: cover;
      }
      #shopify-section-{{ section.id }} .rating-with-text .product-card__title{
        font-size: 24px;
        line-height: 28px;
      }
      #shopify-section-{{ section.id }} .rating-with-text {
        margin-top: 30px;
        gap: 8px;
      }
      #shopify-section-{{ section.id }} .price-list {
        margin: 18px 0;
        font-size: 22px;
        line-height: 21.5px;
      }
      #shopify-section-{{ section.id }} .product-card .product-card__swatch-list {
        gap: 10px;
      }
      #shopify-section-{{ section.id }} .product-card .product-card__swatch-list .color-swatch {
        width: 26px;
        height: 26px;
      }
      #shopify-section-{{ section.id }} .color-swatch__view-more:after {
        content: url('https://cdn.shopify.com/s/files/1/0496/2936/4391/files/plus-sign.svg?v=1725035038');
      }
      #shopify-section-{{ section.id }} .product-card .product-card__swatch-list .color-swatch:before {
        content: url(/cdn/shop/files/check-mark.svg?v=1724226774);
        inset: unset
      }
      #shopify-section-{{ section.id }} .product-card .product-card__swatch-list .speckled.color-swatch:before {
        content: url(/cdn/shop/files/check-mark-black.svg?v=1724226774);
        inset: unset
      }

      #shopify-section-{{ section.id }} .rating-with-text .jdgm-preview-badge .jdgm-prev-badge__text {
        font-size: 14px;
        line-height: 21px;
      }
      #shopify-section-{{ section.id }} .rating-with-text .jdgm-prev-badge__stars .jdgm-star {
        width: 16px;
        height: 16px;
      }
      #shopify-section-{{ section.id }} .goshop {
        height: 56px;
        padding: 18 0px;
        gap: 8px;
        border-radius: 36px;
        font-size: 20px;
        line-height: 19.6px;
        width: 80%;
        margin: 22px auto 30px auto;
      }
      #shopify-section-{{ section.id }} .goshop svg{
        width: 16px;
        height: 16px;
      }
      #shopify-section-{{ section.id }} .product-card__quick-buy button {
        font-size: 0.75rem;
        padding: 0.625rem 1.25rem;
      }
    }

    @media screen and (min-width: 1000px) {
      #shopify-section-{{ section.id }} {
        --product-list-items-per-row: {% if section.settings.filter_layout == 'sidebar' %}2{% else %}{{ section.settings.products_per_row_desktop | at_most: 3 }}{% endif %};
        --product-list-promo-grid-column: span 2;
      }
      #shopify-section-{{ section.id }} .container {
        margin: 0 80px;
      }
      #shopify-section-{{ section.id }} .collection  {
        column-gap: 24px;
        row-gap: 18px;
        display: grid;
      }
      #shopify-section-{{ section.id }} .mobile-collection.collection  {
        display: none !important;
      }
      #shopify-section-{{ section.id }} .container .product-list {
        row-gap: 18px;
        column-gap: 30px;
      }
      #shopify-section-{{ section.id }} .collection__top-bar {
        margin: 0px;
      }
      #shopify-section-{{ section.id }} .sort-by-facet {
        gap: 37px;
      }
      #shopify-section-{{ section.id }} .desktop-collection .collection__facets {
        margin: 0;
      }
      #shopify-section-{{ section.id }} .collection .collection__facets .text-with-icon {
        padding: 25px 0 25px 20px;
      }
      #shopify-section-{{ section.id }} .goshop {
        display: none;
      }
      #shopify-section-{{ section.id }} .product-card:hover .goshop,
      #shopify-section-{{ section.id }} .product-card:focus .goshop {
        display: flex;
        transition: 3s;
        cursor: pointer;
      }
    }

    @media screen and (min-width: 1200px) {
      #shopify-section-{{ section.id }} {
        --product-list-items-per-row: {% if section.settings.filter_layout == 'sidebar' %}{{ section.settings.products_per_row_desktop | at_most: 3 }}{% else %}{{ section.settings.products_per_row_desktop }}{% endif %};
      }
      #shopify-section-{{ section.id }} .container {
        margin: 0 90px;
      }
      #shopify-section-{{ section.id }} .container .product-list {
        row-gap: 20px;
        column-gap: 36px;
      }
    }

    @media screen and (min-width: 1400px) {
      #shopify-section-{{ section.id }} {
        --product-list-items-per-row: {{ section.settings.products_per_row_desktop }};
      }

      {%- for block in section.blocks -%}
        #block-{{ section.id }}-{{ block.id }} {
          --product-list-promo-grid-column: span {{ block.settings.column_span }};

          {%- if block.settings.column_span == '2' -%}
            --content-over-media-column-gap: var(--spacing-12);
          {%- endif -%}
        }
      {%- endfor -%}

      #shopify-section-{{ section.id }} .container {
        margin: 0 120px;
      }
      #shopify-section-{{ section.id }} .container .product-list {
        row-gap: 24px;
        column-gap: 48px;
      }
    }
    @media screen and (pointer: fine) {
      .group:hover .reversed-link, .reversed-link.hover\:show:hover {
          background-size: white;
      }
      .group:hover .circle-chevron.group-hover\:colors:not([disabled]), .circle-chevron.hover\:colors:hover:not([disabled]) {

      }
    }
  }
</style>

<div class="container">
  {%- if collection.all_products_count == 0 -%}
    <div class="empty-state">
      <div class="empty-state__icon-wrapper">
        {%- render 'icon' with 'picto-stop', width: 32, height: 32, stroke_width: 1 -%}
        <span class="count-bubble count-bubble--lg">0</span>
      </div>

      <div class="prose">
        <p class="h4">{{ 'collection.general.empty_collection' | t }}</p>

        {%- assign button_content = 'collection.general.continue_shopping' | t -%}
        {%- render 'button', href: routes.all_products_collection_url, size: 'xl', content: button_content -%}
      </div>
    </div>
  {%- else -%}
    {%- paginate collection.products by section.settings.products_per_page -%}
      {% comment %}
        <div class="mobile-collection collection {% if show_filters %}collection--filters-{{ section.settings.filter_layout | escape }}{% endif %}">
          {%- if show_filters or section.settings.show_sort_by -%}
            {%- comment -%}
              IMPLEMENTATION NOTE: we have to output the drawer no matter what, as it is used on mobile (all the time) or desktop (when in drawer mode)
            {%- endcomment -%}

            <facet-drawer header-bordered id="facets-drawer" class="facets-drawer drawer" open-from="left">
              <p class="h5" slot="header">{{ 'collection.faceting.filters' | t }}</p>
              {%- render 'facets-vertical',
                results: collection,
                show_filters: true,
                show_sort_by: section.settings.show_sort_by,
                update_on_change: false
              -%}
            </facet-drawer>
            {%- comment -%}We also need to render the button, that is floating on mobile{%- endcomment -%}
            {%- if show_filters -%}
              <facet-floating-filter class="facets__floating-filter md:hidden">
                {%- assign filter_label = 'collection.faceting.filter_and_sort' | t -%}
                {%- render 'button',
                  size: 'xl',
                  content: filter_label,
                  icon: 'filter',
                  style: 'fill',
                  background: settings.text_color,
                  text_color: settings.background,
                  aria_controls: 'facets-drawer'
                -%}
              </facet-floating-filter>
            {%- endif -%}
          {%- endif -%}
          <div class="collection__results">
            {%- if collection.products_count == 0 -%}
              <div class="empty-state">
                <div class="empty-state__icon-wrapper">
                  {%- render 'icon' with 'picto-stop', width: 32, height: 32, stroke_width: 1 -%}
                  <span class="count-bubble count-bubble--lg">0</span>
                </div>

                <div class="prose">
                  <p class="h5">{{ 'collection.faceting.no_results' | t }}</p>

                  {%- assign button_content = 'collection.faceting.clear_filters' | t -%}
                  {%- render 'button', href: collection.url, is: 'facet-link', size: 'xl', content: button_content -%}
                </div>
              </div>
            {%- else -%}
              <div class="v-stack gap-6">
                <reveal-items selector=".product-list > *">
                  <product-list class="product-list" role="region" aria-live="polite">
                    {%- for product in collection.products -%}
                      {%- for block in section.blocks -%}
                        {%- if forloop.parentloop.index != block.settings.position -%}
                          {%- continue -%}
                        {%- endif -%}

                        <div
                          id="block-{{ section.id }}-{{ block.id }}"
                          {% render 'surface',
                            class: 'product-list__promo group',
                            text_color: block.settings.text_color
                          %}
                          {{ block.shopify_attributes }}
                        >
                          <a
                            {% if block.settings.link_url %}
                              href="{{ block.settings.link_url }}"
                            {% endif %}
                            class="content-over-media h-full rounded-sm"
                            style="--content-over-media-overlay: {{ block.settings.overlay_color.rgb }} / {{ block.settings.overlay_opacity | divided_by: 100.0 }}"
                          >
                            {%- case block.type -%}
                              {%- when 'promotion_image' -%}
                                {%- liquid
                                  assign loading_strategy = null

                                  if section.index > 3 or forloop.index > 3
                                    assign loading_strategy = 'lazy'
                                  endif
                                -%}

                                {%- if block.settings.image != blank -%}
                                  <picture>
                                    {%- capture sizes -%}(max-width: 699px) 100vw, {{ 400 | times: block.settings.column_span }}px{%- endcapture -%}

                                    <source
                                      media="(max-width: 699px)"
                                      srcset="{{ block.settings.mobile_image | image_url: width: '400x' }} 400w, {{ block.settings.mobile_image | image_url: width: '600x' }} 600w, {{ block.settings.mobile_image | image_url: width: '800x' }} 800w, {{ block.settings.mobile_image | image_url: width: '1000x' }} 1000w, {{ block.settings.mobile_image | image_url: width: '1200x' }} 1200w"
                                      width="{{ block.settings.mobile_image.width }}"
                                      height="{{ block.settings.mobile_image.height }}"
                                    >

                                    {{-
                                      block.settings.image
                                      | image_url: width: block.settings.image.width
                                      | image_tag:
                                        loading: loading_strategy,
                                        sizes: sizes,
                                        widths: '200,300,400,500,600,700,800,900,1000,1200,1400,1600',
                                        class: 'zoom-image'
                                    -}}
                                  </picture>
                                {%- endif -%}

                              {%- when 'promotion_video' -%}
                                {%- if block.settings.video -%}
                                  <video-media autoplay>
                                    {{-
                                      block.settings.video
                                      | video_tag: playsinline: true, muted: true, loop: true, preload: 'metadata'
                                    -}}
                                  </video-media>
                                {%- else -%}
                                  <video-media host="{{ block.settings.external_video_url.type }}" autoplay>
                                    <template>
                                      {%- if block.settings.external_video_url.type == 'youtube' -%}
                                        <iframe
                                          src="https://www.youtube.com/embed/{{ block.settings.external_video_url.id }}?playsinline=1&autoplay=1&controls=0&mute=1&loop=1&playlist={{ block.settings.external_video_url.id }}&enablejsapi=1&rel=0&modestbranding=1&origin={{ 'https://' | append: request.host | url_encode }}"
                                          allow="autoplay; encrypted-media"
                                          allowfullscreen="allowfullscreen"
                                        ></iframe>
                                      {%- elsif block.settings.external_video_url.type == 'vimeo' -%}
                                        <iframe
                                          src="https://player.vimeo.com/video/{{ block.settings.external_video_url.id }}?autoplay=1&autopause=1&background=1&loop=1&muted=1&transparent=0&responsive=1&portrait=0&title=0&byline=0&color={{ settings.text_color | remove_first: '#' }}"
                                          allow="autoplay; encrypted-media;"
                                          allowfullscreen="allowfullscreen"
                                        ></iframe>
                                      {%- endif -%}
                                    </template>
                                  </video-media>
                                {%- endif -%}
                            {%- endcase -%}

                            {%- if block.settings.title != blank or block.settings.link_text != blank -%}
                              <div class="{{ block.settings.text_position }}">
                                <div class="v-stack gap-4 sm:gap-6 {% if block.settings.text_position contains 'text-center' %}justify-items-center{% elsif block.settings.text_position contains 'text-end' %}justify-items-end{% endif %}">
                                  {%- if block.settings.title != blank or block.settings.content != blank -%}
                                    <div class="prose">
                                      {%- if block.settings.title != blank -%}
                                        <p class="{{ block.settings.heading_tag }}">
                                          {{ block.settings.title | escape }}
                                        </p>
                                      {%- endif -%}

                                      {{- block.settings.content -}}
                                    </div>
                                  {%- endif -%}

                                  {%- if block.settings.link_text != blank -%}
                                    <div class="h-stack gap-4">
                                      <span class="bold">{{- block.settings.link_text | escape -}}</span>

                                      <div class="circle-button circle-button--sm ring-current">
                                        <span class="sr-only">{{ 'general.accessibility.previous' | t }}</span>
                                        <span class="animated-arrow"></span>
                                      </div>
                                    </div>
                                  {%- endif -%}
                                </div>
                              </div>
                            {%- endif -%}
                          </a>
                        </div>
                      {%- endfor -%}

                      {%- render 'product-card',
                        product: product,
                        stacked: true,
                        position: forloop.index,
                        show_badges: true
                      -%}
                    {%- endfor -%}
                  </product-list>
                </reveal-items>
              </div>
            {%- endif -%}
          </div>

          {%- render 'pagination', paginate: paginate, facet: true, class: 'collection__pagination' -%}
        </div>
      {% endcomment %}
      <div class=" collection {% if show_filters %}collection--filters-{{ section.settings.filter_layout | escape }}{% endif %}">
        {%- if show_filters or section.settings.show_sort_by -%}
          {%- if section.settings.filter_layout == 'horizontal' -%}
            {%- render 'collection-top-bar',
              results: collection,
              show_filters: show_filters,
              show_active_filters: show_filters,
              show_sort_by: section.settings.show_sort_by
            -%}
          {%- else -%}
            {%- render 'collection-top-bar',
              results: collection,
              show_filters: false,
              show_active_filters: show_filters,
              show_sort_by: section.settings.show_sort_by
            -%}
          {%- endif -%}
          <facet-drawer
            header-bordered
            id="facets-drawer"
            shopify_id="{{ section.id }}"
            class="facets-drawer drawer"
            open-from="left"
          >
            <p class="h5" slot="header">FILTER PRODUCTS</p>
            {%- render 'facets-vertical',
              results: collection,
              show_filters: true,
              show_sort_by: section.settings.show_sort_by,
              update_on_change: false
            -%}
          </facet-drawer>
          {%- comment -%}We also need to render the button, that is floating on mobile{%- endcomment -%}
          {%- if show_filters -%}
            <facet-floating-filter class="facets__floating-filter md:hidden">
              {%- assign filter_label = 'collection.faceting.filter_and_sort' | t -%}
              {%- render 'button',
                size: 'xl',
                content: filter_label,
                icon: 'filter',
                style: 'fill',
                background: settings.text_color,
                text_color: settings.background,
                aria_controls: 'facets-drawer'
              -%}
            </facet-floating-filter>
          {%- endif -%}
        {%- endif -%}
        {%- if show_filters and section.settings.filter_layout == 'sidebar' -%}
          <div class="collection__facets">
            {%- if show_filters -%}
              {%- if section.settings.filter_layout == 'drawer' -%}
                <button
                  class="text-with-icon group justify-self-start"
                  aria-controls="facets-drawer"
                  aria-expanded="false"
                >
                  <span class="reversed-link">{{- 'collection.faceting.filters' | t -}}</span>
                  {%- render 'icon' with 'filter', class: 'icon-subdued' -%}
                </button>
              {%- elsif section.settings.filter_layout == 'sidebar' -%}
                <div class="text-with-icon">
                  {% comment %} {{- 'collection.faceting.filters' | t -}} {% endcomment %}
                  <span>FILTER PRODUCTS</span>
                  <button>
                    {%- render 'icon' with 'filter', class: 'icon-subdued' -%}
                  </button>
                </div>
              {%- endif -%}
            {%- endif -%}
            <safe-sticky class="collection__facets-scroller">
              {%- render 'facets-vertical',
                results: collection,
                show_filters: true,
                show_sort_by: false,
                update_on_change: true
              -%}
            </safe-sticky>
          </div>
        {%- endif -%}
        <div class="collection__results">
          {%- if collection.products_count == 0 -%}
            <div class="empty-state">
              <div class="empty-state__icon-wrapper">
                {%- render 'icon' with 'picto-stop', width: 32, height: 32, stroke_width: 1 -%}
                <span class="count-bubble count-bubble--lg">0</span>
              </div>

              <div class="prose">
                <p class="h5">{{ 'collection.faceting.no_results' | t }}</p>

                {%- assign button_content = 'collection.faceting.clear_filters' | t -%}
                {%- render 'button', href: collection.url, is: 'facet-link', size: 'xl', content: button_content -%}
              </div>
            </div>
          {%- else -%}
            <div class="v-stack gap-6">
              <reveal-items selector=".product-list > *">
                <product-list class="product-list" role="region" aria-live="polite">
                  {%- for product in collection.products -%}
                    {%- for block in section.blocks -%}
                      {%- if forloop.parentloop.index != block.settings.position -%}
                        {%- continue -%}
                      {%- endif -%}

                      <div
                        id="block-{{ section.id }}-{{ block.id }}"
                        {% render 'surface',
                          class: 'product-list__promo group',
                          text_color: block.settings.text_color
                        %}
                        {{ block.shopify_attributes }}
                      >
                        <a
                          {% if block.settings.link_url %}
                            href="{{ block.settings.link_url }}"
                          {% endif %}
                          class="content-over-media h-full rounded-sm"
                          style="--content-over-media-overlay: {{ block.settings.overlay_color.rgb }} / {{ block.settings.overlay_opacity | divided_by: 100.0 }}"
                        >
                          {%- case block.type -%}
                            {%- when 'promotion_image' -%}
                              {%- liquid
                                assign loading_strategy = null

                                if section.index > 3 or forloop.index > 3
                                  assign loading_strategy = 'lazy'
                                endif
                              -%}

                              {%- if block.settings.image != blank -%}
                                <picture>
                                  {%- capture sizes -%}(max-width: 699px) 100vw, {{ 400 | times: block.settings.column_span }}px{%- endcapture -%}

                                  <source
                                    media="(max-width: 699px)"
                                    srcset="{{ block.settings.mobile_image | image_url: width: '400x' }} 400w, {{ block.settings.mobile_image | image_url: width: '600x' }} 600w, {{ block.settings.mobile_image | image_url: width: '800x' }} 800w, {{ block.settings.mobile_image | image_url: width: '1000x' }} 1000w, {{ block.settings.mobile_image | image_url: width: '1200x' }} 1200w"
                                    width="{{ block.settings.mobile_image.width }}"
                                    height="{{ block.settings.mobile_image.height }}"
                                  >

                                  {{-
                                    block.settings.image
                                    | image_url: width: block.settings.image.width
                                    | image_tag:
                                      loading: loading_strategy,
                                      sizes: sizes,
                                      widths: '200,300,400,500,600,700,800,900,1000,1200,1400,1600',
                                      class: 'zoom-image'
                                  -}}
                                </picture>
                              {%- endif -%}

                            {%- when 'promotion_video' -%}
                              {%- if block.settings.video -%}
                                <video-media autoplay>
                                  {{-
                                    block.settings.video
                                    | video_tag: playsinline: true, muted: true, loop: true, preload: 'metadata'
                                  -}}
                                </video-media>
                              {%- else -%}
                                <video-media host="{{ block.settings.external_video_url.type }}" autoplay>
                                  <template>
                                    {%- if block.settings.external_video_url.type == 'youtube' -%}
                                      <iframe
                                        src="https://www.youtube.com/embed/{{ block.settings.external_video_url.id }}?playsinline=1&autoplay=1&controls=0&mute=1&loop=1&playlist={{ block.settings.external_video_url.id }}&enablejsapi=1&rel=0&modestbranding=1&origin={{ 'https://' | append: request.host | url_encode }}"
                                        allow="autoplay; encrypted-media"
                                        allowfullscreen="allowfullscreen"
                                      ></iframe>
                                    {%- elsif block.settings.external_video_url.type == 'vimeo' -%}
                                      <iframe
                                        src="https://player.vimeo.com/video/{{ block.settings.external_video_url.id }}?autoplay=1&autopause=1&background=1&loop=1&muted=1&transparent=0&responsive=1&portrait=0&title=0&byline=0&color={{ settings.text_color | remove_first: '#' }}"
                                        allow="autoplay; encrypted-media;"
                                        allowfullscreen="allowfullscreen"
                                      ></iframe>
                                    {%- endif -%}
                                  </template>
                                </video-media>
                              {%- endif -%}
                          {%- endcase -%}

                          {%- if block.settings.title != blank or block.settings.link_text != blank -%}
                            <div class="{{ block.settings.text_position }}">
                              <div class="v-stack gap-4 sm:gap-6 {% if block.settings.text_position contains 'text-center' %}justify-items-center{% elsif block.settings.text_position contains 'text-end' %}justify-items-end{% endif %}">
                                {%- if block.settings.title != blank or block.settings.content != blank -%}
                                  <div class="prose">
                                    {%- if block.settings.title != blank -%}
                                      <p class="{{ block.settings.heading_tag }}">
                                        {{ block.settings.title | escape }}
                                      </p>
                                    {%- endif -%}

                                    {{- block.settings.content -}}
                                  </div>
                                {%- endif -%}

                                {%- if block.settings.link_text != blank -%}
                                  <div class="h-stack gap-4">
                                    <span class="bold">{{- block.settings.link_text | escape -}}</span>

                                    <div class="circle-button circle-button--sm ring-current">
                                      <span class="sr-only">{{ 'general.accessibility.previous' | t }}</span>
                                      <span class="animated-arrow"></span>
                                    </div>
                                  </div>
                                {%- endif -%}
                              </div>
                            </div>
                          {%- endif -%}
                        </a>
                      </div>
                    {%- endfor -%}

                    {%- render 'product-card',
                      product: product,
                      stacked: true,
                      position: forloop.index,
                      show_badges: true
                    -%}
                  {%- endfor -%}
                </product-list>
              </reveal-items>
            </div>
          {%- endif -%}
        </div>

        {%- render 'pagination', paginate: paginate, facet: true, class: 'collection__pagination' -%}
      </div>
    {%- endpaginate -%}
  {%- endif -%}
</div>
{% schema %}
{
  "name": "Collection page",
  "class": "shopify-section--main-collection",
  "tag": "section",
  "max_blocks": 5,
  "blocks": [
    {
      "type": "promotion_image",
      "name": "Promotion image",
      "settings": [
        {
          "type": "paragraph",
          "content": "Blocks may be hidden if not enough products are visible."
        },
        {
          "type": "range",
          "id": "position",
          "min": 1,
          "max": 50,
          "label": "Position in grid",
          "default": 4
        },
        {
          "type": "select",
          "id": "column_span",
          "label": "Desktop item size",
          "info": "Size is adjusted automatically on smaller screen to improve user experience.",
          "options": [
            {
              "value": "1",
              "label": "1 column"
            },
            {
              "value": "2",
              "label": "2 columns"
            }
          ],
          "default": "1"
        },
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image",
          "info": "1600 x 1000px .jpg recommended"
        },
        {
          "type": "image_picker",
          "id": "mobile_image",
          "label": "Mobile image",
          "info": "1000 x 1000px .jpg recommended. Default to desktop image."
        },
        {
          "type": "text",
          "id": "title",
          "label": "Heading",
          "default": "Promote a product or a temporary offer"
        },
        {
          "type": "richtext",
          "id": "content",
          "label": "Content"
        },
        {
          "type": "url",
          "id": "link_url",
          "label": "Link URL"
        },
        {
          "type": "text",
          "id": "link_text",
          "label": "Link text",
          "default": "View all"
        },
        {
          "type": "select",
          "id": "heading_tag",
          "label": "Heading style",
          "options": [
            {
              "value": "h1",
              "label": "X-Large"
            },
            {
              "value": "h2",
              "label": "Large"
            },
            {
              "value": "h3",
              "label": "Medium"
            },
            {
              "value": "h4",
              "label": "Small"
            },
            {
              "value": "h5",
              "label": "X-Small"
            },
            {
              "value": "h6",
              "label": "XX-Small"
            }
          ],
          "default": "h4"
        },
        {
          "type": "select",
          "id": "text_position",
          "label": "Content position",
          "options": [
            {
              "value": "place-self-start text-start",
              "label": "Top left"
            },
            {
              "value": "place-self-start-center text-center",
              "label": "Top center"
            },
            {
              "value": "place-self-start-end text-end",
              "label": "Top right"
            },
            {
              "value": "place-self-center-start text-start",
              "label": "Middle left"
            },
            {
              "value": "place-self-center text-center",
              "label": "Middle center"
            },
            {
              "value": "place-self-center-end text-end",
              "label": "Middle right"
            },
            {
              "value": "place-self-end-start text-start",
              "label": "Bottom left"
            },
            {
              "value": "place-self-end-center text-center",
              "label": "Bottom center"
            },
            {
              "value": "place-self-end text-end",
              "label": "Bottom right"
            }
          ],
          "default": "place-self-end-start text-start"
        },
        {
          "type": "header",
          "content": "Colors"
        },
        {
          "type": "color",
          "id": "text_color",
          "label": "Text",
          "default": "#ffffff"
        },
        {
          "type": "color",
          "id": "overlay_color",
          "label": "Overlay",
          "default": "#000000"
        },
        {
          "type": "range",
          "id": "overlay_opacity",
          "label": "Overlay opacity",
          "min": 0,
          "max": 100,
          "step": 1,
          "unit": "%",
          "default": 30
        }
      ]
    },
    {
      "type": "promotion_video",
      "name": "Promotion video",
      "settings": [
        {
          "type": "paragraph",
          "content": "Blocks may be hidden if not enough products are visible. Video are muted to allow autoplay. For best visual results and avoid platform branding, we recommend uploading a MP4 file."
        },
        {
          "type": "range",
          "id": "position",
          "min": 1,
          "max": 50,
          "label": "Position in grid",
          "default": 4
        },
        {
          "type": "select",
          "id": "column_span",
          "label": "Desktop item size",
          "info": "Size is adjusted automatically on smaller screen to improve user experience.",
          "options": [
            {
              "value": "1",
              "label": "1 column"
            },
            {
              "value": "2",
              "label": "2 columns"
            }
          ],
          "default": "1"
        },
        {
          "type": "video",
          "id": "video",
          "label": "Video",
          "info": "Replaces external video if both are set."
        },
        {
          "type": "video_url",
          "id": "external_video_url",
          "accept": ["vimeo", "youtube"],
          "label": "External video URL",
          "default": "https://www.youtube.com/watch?v=_9VUPq3SxOc"
        },
        {
          "type": "text",
          "id": "title",
          "label": "Heading",
          "default": "Promote a product or a temporary offer"
        },
        {
          "type": "richtext",
          "id": "content",
          "label": "Content"
        },
        {
          "type": "url",
          "id": "link_url",
          "label": "Link URL"
        },
        {
          "type": "text",
          "id": "link_text",
          "label": "Link text",
          "default": "View all"
        },
        {
          "type": "select",
          "id": "heading_tag",
          "label": "Heading style",
          "options": [
            {
              "value": "h1",
              "label": "X-Large"
            },
            {
              "value": "h2",
              "label": "Large"
            },
            {
              "value": "h3",
              "label": "Medium"
            },
            {
              "value": "h4",
              "label": "Small"
            },
            {
              "value": "h5",
              "label": "X-Small"
            },
            {
              "value": "h6",
              "label": "XX-Small"
            }
          ],
          "default": "h4"
        },
        {
          "type": "select",
          "id": "text_position",
          "label": "Content position",
          "options": [
            {
              "value": "place-self-start text-start",
              "label": "Top left"
            },
            {
              "value": "place-self-start-center text-center",
              "label": "Top center"
            },
            {
              "value": "place-self-start-end text-end",
              "label": "Top right"
            },
            {
              "value": "place-self-center-start text-start",
              "label": "Middle left"
            },
            {
              "value": "place-self-center text-center",
              "label": "Middle center"
            },
            {
              "value": "place-self-center-end text-end",
              "label": "Middle right"
            },
            {
              "value": "place-self-end-start text-start",
              "label": "Bottom left"
            },
            {
              "value": "place-self-end-center text-center",
              "label": "Bottom center"
            },
            {
              "value": "place-self-end text-end",
              "label": "Bottom right"
            }
          ],
          "default": "place-self-end-start text-start"
        },
        {
          "type": "header",
          "content": "Colors"
        },
        {
          "type": "color",
          "id": "text_color",
          "label": "Text",
          "default": "#ffffff"
        },
        {
          "type": "color",
          "id": "overlay_color",
          "label": "Overlay",
          "default": "#000000"
        },
        {
          "type": "range",
          "id": "overlay_opacity",
          "label": "Overlay opacity",
          "min": 0,
          "max": 100,
          "step": 1,
          "unit": "%",
          "default": 30
        }
      ]
    }
  ],
  "settings": [
    {
      "type": "range",
      "id": "products_per_page",
      "label": "Products per page",
      "min": 8,
      "max": 50,
      "step": 1,
      "default": 24
    },
    {
      "type": "select",
      "id": "products_per_row_mobile",
      "label": "Products per row (mobile)",
      "options": [
        {
          "value": "1",
          "label": "1"
        },
        {
          "value": "2",
          "label": "2"
        }
      ],
      "default": "2"
    },
    {
      "type": "range",
      "min": 2,
      "max": 5,
      "id": "products_per_row_desktop",
      "label": "Products per row (desktop)",
      "info": "For best results, limit to 4 when using sidebar filtering. On small screen size, products per row is limited to 2 (with sidebar) or 3 (without sidebar) to maximize readability",
      "default": 3
    },
    {
      "type": "header",
      "content": "Filters & sort"
    },
    {
      "type": "select",
      "id": "filter_layout",
      "label": "Desktop layout",
      "options": [
        {
          "value": "sidebar",
          "label": "Sidebar"
        },
        {
          "value": "horizontal",
          "label": "Horizontal"
        },
        {
          "value": "drawer",
          "label": "Drawer"
        }
      ],
      "default": "sidebar"
    },
    {
      "type": "checkbox",
      "id": "show_sort_by",
      "label": "Show sort by",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_filters",
      "label": "Show filters",
      "info": "[Customize filters](/admin/menus)",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_filter_group_name",
      "label": "Show group name",
      "info": "Group name will be shown inside selected filters.",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "show_filter_values_count",
      "label": "Show filter values count",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "open_filter_group",
      "label": "Open group by default",
      "default": false
    }
  ]
}
{% endschema %}
